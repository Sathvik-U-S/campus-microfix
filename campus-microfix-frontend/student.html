<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Student Issues – Campus MicroFix</title>
  <style>
    body {
      font-family: 'Inter', system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
      background: #f4f6f9;
      margin: 0;
    }
    header {
      background: #059669; /* Secondary Green header */
      color: white;
      padding: 16px 32px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    header a {
      color: #eefdf9;
      text-decoration: none;
      margin-left: 18px;
      font-size: 15px;
      font-weight: 500;
      transition: color 0.2s;
    }
    header a:hover {
        color: white;
    }
    main {
      max-width: 950px;
      margin: 32px auto;
      background: white;
      padding: 30px 35px;
      border-radius: 16px;
      box-shadow: 0 8px 20px rgba(0,0,0,0.08);
      border: 1px solid #e5e7eb;
    }
    h1 {
      margin-top: 0;
      color: #1f2937;
      border-bottom: 2px solid #e5e7eb;
      padding-bottom: 10px;
    }
    .controls {
      display: flex;
      gap: 12px;
      align-items: center;
      margin-top: 20px;
      margin-bottom: 20px;
      flex-wrap: wrap;
      padding: 15px;
      background: #f9fafb;
      border-radius: 10px;
      border: 1px solid #e5e7eb;
    }
    input[type="email"] {
      padding: 10px 12px;
      border-radius: 8px;
      border: 1px solid #d1d5db;
      min-width: 280px;
      font-size: 15px;
      transition: border-color 0.2s, box-shadow 0.2s;
    }
    input[type="email"]:focus {
        border-color: #059669;
        box-shadow: 0 0 0 3px #d1fae5;
        outline: none;
    }
    button {
      border: none;
      border-radius: 999px;
      padding: 10px 18px;
      background: #059669;
      color: white;
      font-weight: 700;
      font-size: 15px;
      cursor: pointer;
      transition: background 0.2s;
    }
    button:hover:not(:disabled) {
        background: #047857;
    }
    button:disabled {
      opacity: 0.6;
      cursor: default;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 14px;
      margin-top: 15px;
    }
    th, td {
      border-bottom: 1px solid #e5e7eb;
      padding: 12px 10px;
      text-align: left;
    }
    th {
      font-size: 12px;
      text-transform: uppercase;
      color: #4b5563;
      background: #f9fafb;
      font-weight: 600;
    }
    tr:last-child td {
        border-bottom: none;
    }
    .badge {
      display: inline-block;
      padding: 4px 10px;
      border-radius: 999px;
      font-size: 11px;
      font-weight: 700;
      text-transform: uppercase;
    }
    /* Statuses */
    .status-open { background:#fee2e2;color:#b91c1c; }
    .status-inprogress { background:#dbeafe;color:#1d4ed8; }
    .status-resolved { background:#dcfce7;color:#059669; }
    /* Priorities */
    .priority-low { background:#e5e7eb;color:#374151; }
    .priority-medium { background:#fef08a;color:#a16207; }
    .priority-high { background:#fecaca;color:#b91c1c; }
    .priority-critical { background:#fce7f3;color:#be185d; } /* New Critical Color */

    .msg {
      font-size: 14px;
      color: #6b7280;
    }
  </style>
</head>
<body>
<header>
  <div>Campus MicroFix – Student Status Tracker</div>
  <nav>
    <a href="index.html">Home</a>
    <a href="report.html">Report Issue</a>
    <a href="staff.html">Staff Dashboard</a>
  </nav>
</header>

<main>
  <h1>Track My Reported Issues</h1>
  <p class="msg">
    Enter the same email/ID you used when submitting your issue to see its current status.
  </p>

  <div class="controls">
    <input type="email" id="emailInput" placeholder="student1@campus.edu" />
    <button id="loadBtn">Load My Issues</button>
    <span id="statusText" class="msg"></span>
  </div>

  <div style="overflow-x:auto;">
    <table>
      <thead>
        <tr>
          <th>Title</th>
          <th>Category</th>
          <th>Priority</th>
          <th>Status</th>
          <th>Location</th>
          <th>Updated</th>
        </tr>
      </thead>
      <tbody id="issuesBody">
        </tbody>
    </table>
  </div>
</main>

<script>
const API_BASE = "https://campus-microfix-backend.onrender.com/api";


function statusBadge(status) {
  const s = (status || "").toLowerCase();
  if (s === "in progress") return '<span class="badge status-inprogress">In Progress</span>';
  if (s === "resolved") return '<span class="badge status-resolved">Resolved</span>';
  return '<span class="badge status-open">Open</span>';
}
function priorityBadge(priority) {
  const p = (priority || "").toLowerCase();
  if (p === "critical") return '<span class="badge priority-critical">Critical</span>';
  if (p === "high") return '<span class="badge priority-high">High</span>';
  if (p === "medium") return '<span class="badge priority-medium">Medium</span>';
  return '<span class="badge priority-low">Low</span>';
}

document.getElementById("loadBtn").addEventListener("click", async () => {
  const email = document.getElementById("emailInput").value.trim();
  const statusText = document.getElementById("statusText");
  const tbody = document.getElementById("issuesBody");

  if (!email) {
    statusText.textContent = "Please enter your email/ID.";
    return;
  }

  statusText.textContent = "Loading issues...";
  tbody.innerHTML = "";

  try {
    const res = await fetch(`${API_BASE}/issues?reportedBy=${encodeURIComponent(email)}`);
    const data = await res.json();

    if (!Array.isArray(data) || data.length === 0) {
      statusText.textContent = "No issues found for this email.";
      return;
    }

    statusText.textContent = `Showing ${data.length} issue(s).`;

    tbody.innerHTML = data.map(issue => `
      <tr>
        <td>${issue.title}</td>
        <td>${issue.category || "-"}</td>
        <td>${priorityBadge(issue.priority)}</td>
        <td>${statusBadge(issue.status)}</td>
        <td>${issue.locationText || "-"}</td>
        <td>${issue.updatedAt ? new Date(issue.updatedAt).toLocaleString() : "-"}</td>
      </tr>
    `).join("");
  } catch (err) {
    console.error(err);
    statusText.textContent = "Failed to load issues.";
  }
});
</script>
</body>
</html>