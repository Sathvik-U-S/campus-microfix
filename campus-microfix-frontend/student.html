<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Student Issues – Campus MicroFix</title>
  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: #f3f4f6;
      margin: 0;
    }
    header {
      background: #1f2937;
      color: white;
      padding: 12px 24px;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    header a {
      color: #e5e7eb;
      text-decoration: none;
      margin-left: 12px;
      font-size: 14px;
    }
    main {
      max-width: 900px;
      margin: 24px auto;
      background: white;
      padding: 24px 28px;
      border-radius: 16px;
      box-shadow: 0 10px 24px rgba(0,0,0,0.06);
    }
    h1 {
      margin-top: 0;
    }
    .controls {
      display: flex;
      gap: 8px;
      align-items: center;
      margin-bottom: 16px;
      flex-wrap: wrap;
    }
    input[type="email"] {
      padding: 8px 10px;
      border-radius: 999px;
      border: 1px solid #d1d5db;
      min-width: 260px;
    }
    button {
      border: none;
      border-radius: 999px;
      padding: 8px 14px;
      background: #2563eb;
      color: white;
      font-weight: 600;
      font-size: 14px;
      cursor: pointer;
    }
    button:disabled {
      opacity: 0.6;
      cursor: default;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 13px;
    }
    th, td {
      border-bottom: 1px solid #e5e7eb;
      padding: 8px 6px;
      text-align: left;
    }
    th {
      font-size: 12px;
      text-transform: uppercase;
      color: #6b7280;
    }
    .badge {
      display: inline-block;
      padding: 2px 8px;
      border-radius: 999px;
      font-size: 11px;
      font-weight: 600;
    }
    .status-open { background:#fee2e2;color:#b91c1c; }
    .status-inprogress { background:#dbeafe;color:#1d4ed8; }
    .status-resolved { background:#dcfce7;color:#15803d; }
    .priority-low { background:#e5e7eb;color:#374151; }
    .priority-medium { background:#fef9c3;color:#854d0e; }
    .priority-high { background:#fee2e2;color:#b91c1c; }
    .priority-critical { background:#fecaca;color:#7f1d1d; }
    .msg {
      font-size: 13px;
      color: #6b7280;
      margin-bottom: 4px;
    }
  </style>
</head>
<body>
<header>
  <div>Campus MicroFix – Student Status</div>
  <nav>
    <a href="index.html">Home</a>
    <a href="report.html">Report Issue</a>
    <a href="staff.html">Staff Dashboard</a>
  </nav>
</header>

<main>
  <h1>Track My Reported Issues</h1>
  <p class="msg">
    Enter the same email/ID you used while reporting issues.
  </p>

  <div class="controls">
    <input type="email" id="emailInput" placeholder="student1@campus.edu" />
    <button id="loadBtn">Load My Issues</button>
    <span id="statusText" class="msg"></span>
  </div>

  <div style="overflow-x:auto;">
    <table>
      <thead>
        <tr>
          <th>Title</th>
          <th>Category</th>
          <th>Priority</th>
          <th>Status</th>
          <th>Location</th>
          <th>Updated</th>
        </tr>
      </thead>
      <tbody id="issuesBody">
        <!-- rows go here -->
      </tbody>
    </table>
  </div>
</main>

<script>
const API_BASE = "https://campus-microfix-backend.onrender.com/api";


function statusBadge(status) {
  const s = (status || "").toLowerCase();
  if (s === "in progress") return '<span class="badge status-inprogress">In Progress</span>';
  if (s === "resolved") return '<span class="badge status-resolved">Resolved</span>';
  return '<span class="badge status-open">Open</span>';
}
function priorityBadge(priority) {
  const p = (priority || "").toLowerCase();
  if (p === "critical") return '<span class="badge priority-critical">Critical</span>';
  if (p === "high") return '<span class="badge priority-high">High</span>';
  if (p === "medium") return '<span class="badge priority-medium">Medium</span>';
  return '<span class="badge priority-low">Low</span>';
}

document.getElementById("loadBtn").addEventListener("click", async () => {
  const email = document.getElementById("emailInput").value.trim();
  const statusText = document.getElementById("statusText");
  const tbody = document.getElementById("issuesBody");

  if (!email) {
    statusText.textContent = "Please enter your email/ID.";
    return;
  }

  statusText.textContent = "Loading issues...";
  tbody.innerHTML = "";

  try {
    const res = await fetch(`${API_BASE}/issues?reportedBy=${encodeURIComponent(email)}`);
    const data = await res.json();

    if (!Array.isArray(data) || data.length === 0) {
      statusText.textContent = "No issues found for this email.";
      return;
    }

    statusText.textContent = `Showing ${data.length} issue(s).`;

    tbody.innerHTML = data.map(issue => `
      <tr>
        <td>${issue.title}</td>
        <td>${issue.category || "-"}</td>
        <td>${priorityBadge(issue.priority)}</td>
        <td>${statusBadge(issue.status)}</td>
        <td>${issue.locationText || "-"}</td>
        <td>${issue.updatedAt ? new Date(issue.updatedAt).toLocaleString() : "-"}</td>
      </tr>
    `).join("");
  } catch (err) {
    console.error(err);
    statusText.textContent = "Failed to load issues.";
  }
});
</script>
</body>
</html>
